!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("react-dom")):"function"==typeof define&&define.amd?define(["react","react-dom"],t):"object"==typeof exports?exports.__NOTUR_BRIDGE__=t(require("react"),require("react-dom")):e.__NOTUR_BRIDGE__=t(e.React,e.ReactDOM)}(self,(e,t)=>(()=>{"use strict";var r={36(t){t.exports=e},47(e){e.exports=t}},o={};function n(e){var t=o[e];if(void 0!==t)return t.exports;var s=o[e]={exports:{}};return r[e](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var s={};n.r(s),n.d(s,{InlineSlot:()=>E,PluginRegistry:()=>c,RouteRenderer:()=>b,SLOT_DEFINITIONS:()=>d,SLOT_IDS:()=>u,SlotRenderer:()=>g,ThemeProvider:()=>C,useExtensionApi:()=>S,useExtensionState:()=>O,useNoturTheme:()=>D,useRoutes:()=>v,useSlot:()=>R});var i=n(36),a=n(47);class c{constructor(){this.extensions=new Map,this.slotRegistrations=new Map,this.routeRegistrations=[],this.themeRegistrations=[],this.destroyCallbacks=new Map,this.listeners=new Map,this.eventBusListeners=new Map}registerSlot(e){const t={extensionId:e.extensionId||"unknown",order:0,priority:0,...e},r=this.slotRegistrations.get(t.slot)||[];r.push(t),r.sort((e,t)=>{var r,o,n,s;const i=(null!==(r=t.priority)&&void 0!==r?r:0)-(null!==(o=e.priority)&&void 0!==o?o:0);if(0!==i)return i;const a=(null!==(n=e.order)&&void 0!==n?n:0)-(null!==(s=t.order)&&void 0!==s?s:0);return 0!==a?a:(e.extensionId||"").localeCompare(t.extensionId||"")}),this.slotRegistrations.set(t.slot,r),this.emit("slot:"+t.slot),this.emit("change")}registerRoute(e,t){const r={extensionId:t.extensionId||"unknown",area:e,...t};this.routeRegistrations.push(r),this.emit("route:"+e),this.emit("change")}registerExtension(e){this.extensions.set(e.id,e);const t=this.resolveScopeClass(e);for(const r of e.slots)this.registerSlot({...r,extensionId:e.id,scopeClass:t});for(const r of e.routes)this.registerRoute(r.area,{...r,extensionId:e.id,scopeClass:t});e.theme&&this.registerTheme({...e.theme,extensionId:e.id}),this.emit("extension:registered")}registerDestroyCallback(e,t){this.destroyCallbacks.set(e,t)}unregisterExtension(e){const t=this.destroyCallbacks.get(e);if(t)try{t()}catch(t){console.error(`[Notur] Extension ${e} destroy error:`,t)}this.extensions.delete(e);for(const[t,r]of this.slotRegistrations.entries()){const o=r.filter(t=>t.extensionId!==e);o.length!==r.length&&(this.slotRegistrations.set(t,o),this.emit("slot:"+t))}this.routeRegistrations=this.routeRegistrations.filter(t=>t.extensionId!==e),this.themeRegistrations=this.themeRegistrations.filter(t=>t.extensionId!==e),this.destroyCallbacks.delete(e),this.emit("extension:unregistered"),this.emit("change")}getSlot(e){return this.slotRegistrations.get(e)||[]}getRoutes(e){return this.routeRegistrations.filter(t=>t.area===e)}getExtensions(){return Array.from(this.extensions.values())}registerTheme(e){var t;this.themeRegistrations.push({...e,priority:null!==(t=e.priority)&&void 0!==t?t:0}),this.themeRegistrations.sort((e,t)=>{var r,o;return(null!==(r=e.priority)&&void 0!==r?r:0)-(null!==(o=t.priority)&&void 0!==o?o:0)}),this.emit("theme:changed"),this.emit("change")}getThemeOverrides(){const e={};for(const t of this.themeRegistrations)Object.assign(e,t.variables);return e}on(e,t){const r=this.listeners.get(e)||[];return r.push(t),this.listeners.set(e,r),()=>{const e=r.indexOf(t);e>=0&&r.splice(e,1)}}emitEvent(e,t){const r=this.eventBusListeners.get(e)||[];for(const o of r)try{o(t)}catch(t){console.error(`[Notur] Error in event bus listener for "${e}":`,t)}}onEvent(e,t){const r=this.eventBusListeners.get(e)||[];return r.push(t),this.eventBusListeners.set(e,r),()=>{const e=r.indexOf(t);e>=0&&r.splice(e,1)}}emit(e){const t=this.listeners.get(e)||[];for(const r of t)try{r()}catch(t){console.error(`[Notur] Error in registry listener for "${e}":`,t)}}resolveScopeClass(e){if(e.cssIsolation&&"root-class"===e.cssIsolation.mode)return e.cssIsolation.className?e.cssIsolation.className:`notur-ext--${e.id.replace(/[^a-z0-9\-]/gi,"-")}`}}const u={NAVBAR:"navbar",NAVBAR_LEFT:"navbar.left",NAVBAR_BEFORE:"navbar.before",NAVBAR_AFTER:"navbar.after",SERVER_SUBNAV:"server.subnav",SERVER_SUBNAV_BEFORE:"server.subnav.before",SERVER_SUBNAV_AFTER:"server.subnav.after",SERVER_HEADER:"server.header",SERVER_PAGE:"server.page",SERVER_FOOTER:"server.footer",SERVER_TERMINAL_BUTTONS:"server.terminal.buttons",SERVER_CONSOLE_HEADER:"server.console.header",SERVER_CONSOLE_INFO_BEFORE:"server.console.info.before",SERVER_CONSOLE_INFO_AFTER:"server.console.info.after",SERVER_CONSOLE_SIDEBAR:"server.console.sidebar",SERVER_CONSOLE_COMMAND:"server.console.command",SERVER_CONSOLE_FOOTER:"server.console.footer",SERVER_FILES_ACTIONS:"server.files.actions",SERVER_FILES_HEADER:"server.files.header",SERVER_FILES_FOOTER:"server.files.footer",SERVER_FILES_DROPDOWN:"server.files.dropdown",SERVER_FILES_EDIT_BEFORE:"server.files.edit.before",SERVER_FILES_EDIT_AFTER:"server.files.edit.after",SERVER_DATABASES_BEFORE:"server.databases.before",SERVER_DATABASES_AFTER:"server.databases.after",SERVER_SCHEDULES_BEFORE:"server.schedules.before",SERVER_SCHEDULES_AFTER:"server.schedules.after",SERVER_SCHEDULES_EDIT_BEFORE:"server.schedules.edit.before",SERVER_SCHEDULES_EDIT_AFTER:"server.schedules.edit.after",SERVER_USERS_BEFORE:"server.users.before",SERVER_USERS_AFTER:"server.users.after",SERVER_BACKUPS_BEFORE:"server.backups.before",SERVER_BACKUPS_AFTER:"server.backups.after",SERVER_BACKUPS_DROPDOWN:"server.backups.dropdown",SERVER_NETWORK_BEFORE:"server.network.before",SERVER_NETWORK_AFTER:"server.network.after",SERVER_STARTUP_BEFORE:"server.startup.before",SERVER_STARTUP_AFTER:"server.startup.after",SERVER_SETTINGS_BEFORE:"server.settings.before",SERVER_SETTINGS_AFTER:"server.settings.after",DASHBOARD_HEADER:"dashboard.header",DASHBOARD_WIDGETS:"dashboard.widgets",DASHBOARD_SERVERLIST_BEFORE:"dashboard.serverlist.before",DASHBOARD_SERVERLIST_AFTER:"dashboard.serverlist.after",DASHBOARD_SERVERROW_NAME_BEFORE:"dashboard.serverrow.name.before",DASHBOARD_SERVERROW_NAME_AFTER:"dashboard.serverrow.name.after",DASHBOARD_SERVERROW_DESCRIPTION_BEFORE:"dashboard.serverrow.description.before",DASHBOARD_SERVERROW_DESCRIPTION_AFTER:"dashboard.serverrow.description.after",DASHBOARD_SERVERROW_LIMITS:"dashboard.serverrow.limits",DASHBOARD_FOOTER:"dashboard.footer",DASHBOARD_PAGE:"dashboard.page",ACCOUNT_HEADER:"account.header",ACCOUNT_PAGE:"account.page",ACCOUNT_FOOTER:"account.footer",ACCOUNT_SUBNAV:"account.subnav",ACCOUNT_SUBNAV_BEFORE:"account.subnav.before",ACCOUNT_SUBNAV_AFTER:"account.subnav.after",ACCOUNT_OVERVIEW_BEFORE:"account.overview.before",ACCOUNT_OVERVIEW_AFTER:"account.overview.after",ACCOUNT_API_BEFORE:"account.api.before",ACCOUNT_API_AFTER:"account.api.after",ACCOUNT_SSH_BEFORE:"account.ssh.before",ACCOUNT_SSH_AFTER:"account.ssh.after",AUTH_CONTAINER_BEFORE:"auth.container.before",AUTH_CONTAINER_AFTER:"auth.container.after"},d=JSON.parse('[{"id":"navbar","type":"portal","description":"Top navigation bar"},{"id":"navbar.left","type":"portal","description":"Navbar left area (near logo)"},{"id":"navbar.before","type":"portal","description":"Navbar items (before built-ins)"},{"id":"navbar.after","type":"portal","description":"Navbar items (after built-ins)"},{"id":"server.subnav","type":"nav","description":"Server sub-navigation"},{"id":"server.subnav.before","type":"nav","description":"Server sub-navigation (before built-ins)"},{"id":"server.subnav.after","type":"nav","description":"Server sub-navigation (after built-ins)"},{"id":"server.header","type":"portal","description":"Server header area"},{"id":"server.page","type":"route","description":"Server area page"},{"id":"server.footer","type":"portal","description":"Server footer area"},{"id":"server.terminal.buttons","type":"portal","description":"Terminal power buttons"},{"id":"server.console.header","type":"portal","description":"Console page header"},{"id":"server.console.info.before","type":"portal","description":"Console info (before details)"},{"id":"server.console.info.after","type":"portal","description":"Console info (after details)"},{"id":"server.console.sidebar","type":"portal","description":"Console sidebar area"},{"id":"server.console.command","type":"portal","description":"Console command row"},{"id":"server.console.footer","type":"portal","description":"Console page footer"},{"id":"server.files.actions","type":"portal","description":"File manager toolbar"},{"id":"server.files.header","type":"portal","description":"File manager header"},{"id":"server.files.footer","type":"portal","description":"File manager footer"},{"id":"server.files.dropdown","type":"portal","description":"File manager dropdown items"},{"id":"server.files.edit.before","type":"portal","description":"File editor (before content)"},{"id":"server.files.edit.after","type":"portal","description":"File editor (after content)"},{"id":"server.databases.before","type":"portal","description":"Databases page (before content)"},{"id":"server.databases.after","type":"portal","description":"Databases page (after content)"},{"id":"server.schedules.before","type":"portal","description":"Schedules list (before content)"},{"id":"server.schedules.after","type":"portal","description":"Schedules list (after content)"},{"id":"server.schedules.edit.before","type":"portal","description":"Schedule editor (before content)"},{"id":"server.schedules.edit.after","type":"portal","description":"Schedule editor (after content)"},{"id":"server.users.before","type":"portal","description":"Users page (before content)"},{"id":"server.users.after","type":"portal","description":"Users page (after content)"},{"id":"server.backups.before","type":"portal","description":"Backups page (before content)"},{"id":"server.backups.after","type":"portal","description":"Backups page (after content)"},{"id":"server.backups.dropdown","type":"portal","description":"Backup row dropdown items"},{"id":"server.network.before","type":"portal","description":"Network page (before content)"},{"id":"server.network.after","type":"portal","description":"Network page (after content)"},{"id":"server.startup.before","type":"portal","description":"Startup page (before content)"},{"id":"server.startup.after","type":"portal","description":"Startup page (after content)"},{"id":"server.settings.before","type":"portal","description":"Settings page (before content)"},{"id":"server.settings.after","type":"portal","description":"Settings page (after content)"},{"id":"dashboard.header","type":"portal","description":"Dashboard header area"},{"id":"dashboard.widgets","type":"portal","description":"Dashboard widgets"},{"id":"dashboard.serverlist.before","type":"portal","description":"Dashboard server list (before)"},{"id":"dashboard.serverlist.after","type":"portal","description":"Dashboard server list (after)"},{"id":"dashboard.serverrow.name.before","type":"portal","description":"Dashboard server row name (before)"},{"id":"dashboard.serverrow.name.after","type":"portal","description":"Dashboard server row name (after)"},{"id":"dashboard.serverrow.description.before","type":"portal","description":"Dashboard server row description (before)"},{"id":"dashboard.serverrow.description.after","type":"portal","description":"Dashboard server row description (after)"},{"id":"dashboard.serverrow.limits","type":"portal","description":"Dashboard server row resource limits"},{"id":"dashboard.footer","type":"portal","description":"Dashboard footer area"},{"id":"dashboard.page","type":"route","description":"Dashboard page"},{"id":"account.header","type":"portal","description":"Account header area"},{"id":"account.page","type":"route","description":"Account page"},{"id":"account.footer","type":"portal","description":"Account footer area"},{"id":"account.subnav","type":"nav","description":"Account sub-navigation"},{"id":"account.subnav.before","type":"nav","description":"Account sub-navigation (before built-ins)"},{"id":"account.subnav.after","type":"nav","description":"Account sub-navigation (after built-ins)"},{"id":"account.overview.before","type":"portal","description":"Account overview (before content)"},{"id":"account.overview.after","type":"portal","description":"Account overview (after content)"},{"id":"account.api.before","type":"portal","description":"Account API (before content)"},{"id":"account.api.after","type":"portal","description":"Account API (after content)"},{"id":"account.ssh.before","type":"portal","description":"Account SSH (before content)"},{"id":"account.ssh.after","type":"portal","description":"Account SSH (after content)"},{"id":"auth.container.before","type":"portal","description":"Authentication container (before content)"},{"id":"auth.container.after","type":"portal","description":"Authentication container (after content)"}]');class l extends i.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var r;console.error(`[Notur] Extension "${this.props.extensionId}" component error:`,e,t.componentStack);const o=window.__NOTUR__;(null===(r=null==o?void 0:o.diagnostics)||void 0===r?void 0:r.errors)&&o.diagnostics.errors.push({extensionId:this.props.extensionId,message:e.message||String(e),stack:e.stack,componentStack:t.componentStack,time:(new Date).toISOString()})}render(){return this.state.hasError?i.createElement("div",{style:{padding:"8px 12px",margin:"4px 0",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"4px",backgroundColor:"rgba(239, 68, 68, 0.1)",color:"#ef4444",fontSize:"12px",fontFamily:"monospace"}},`[Notur] Extension "${this.props.extensionId}" failed to render`):this.props.children}}function p(e){return null==e?[]:Array.isArray(e)?e:[e]}function f(){var e;const t="undefined"!=typeof window?window.location.pathname:"",r=t.startsWith("/admin"),o=/\/server\/[a-f0-9-]+/i.test(t),n=t.startsWith("/account"),s=t.startsWith("/auth")||t.startsWith("/login")||t.startsWith("/register")||t.startsWith("/password"),i=!(r||o||n||s);let a=null;if("undefined"!=typeof document){const t=document.getElementById("app"),r=null===(e=null==t?void 0:t.dataset)||void 0===e?void 0:e.server;if(r)try{const e=JSON.parse(r);Array.isArray(null==e?void 0:e.permissions)&&(a=e.permissions)}catch{}}let c="other";return r?c="admin":o?c="server":n?c="account":s?c="auth":i&&(c="dashboard"),{path:t,area:c,isServer:o,isDashboard:i,isAccount:n,isAdmin:r,isAuth:s,permissions:a}}function h(e,t){var r,o;const n=e.when;let s=null;if(!1===n)return!1;if("function"==typeof n)return n(t);if(n&&"object"==typeof n){if(s=n,s.area&&s.area!==t.area)return!1;if(s.areas&&s.areas.length>0&&!s.areas.includes(t.area))return!1;if("boolean"==typeof s.server&&s.server!==t.isServer)return!1;if("boolean"==typeof s.dashboard&&s.dashboard!==t.isDashboard)return!1;if("boolean"==typeof s.account&&s.account!==t.isAccount)return!1;if("boolean"==typeof s.admin&&s.admin!==t.isAdmin)return!1;if("boolean"==typeof s.auth&&s.auth!==t.isAuth)return!1;const e=p(null!==(r=s.pathStartsWith)&&void 0!==r?r:s.path);if(e.length>0&&(i=t.path,!e.some(e=>i.startsWith(e))))return!1;const o=p(s.pathIncludes);if(o.length>0&&!function(e,t){return t.some(t=>e.includes(t))}(t.path,o))return!1;if(s.pathMatches&&!function(e,t){try{return(t instanceof RegExp?t:new RegExp(t)).test(e)}catch{return!1}}(t.path,s.pathMatches))return!1}var i;const a=null!==(o=null==s?void 0:s.permission)&&void 0!==o?o:e.permission;return!a||function(e,t){if(!e||0===e.length)return!1;const r=p(t);return!!e.includes("*")||r.some(t=>e.includes(t))}(t.permissions,a)}class g extends i.Component{constructor(e){super(e),this.state={registrations:e.registry.getSlot(e.slotId)}}componentDidMount(){this.unsubscribe=this.props.registry.on("slot:"+this.props.slotId,()=>{this.setState({registrations:this.props.registry.getSlot(this.props.slotId)})})}componentWillUnmount(){var e;null===(e=this.unsubscribe)||void 0===e||e.call(this)}render(){const{slotId:e,componentProps:t={}}=this.props,{registrations:r}=this.state,o=document.getElementById(`notur-slot-${e}`);if(!o||0===r.length)return null;const n=f(),s=r.filter(e=>h(e,n));if(0===s.length)return null;const c=s.map((r,o)=>{var n;const s=r.component,a=i.createElement(s,{extensionId:r.extensionId,...t,...null!==(n=r.props)&&void 0!==n?n:{}}),c=r.scopeClass?i.createElement("div",{className:r.scopeClass,"data-notur-extension":r.extensionId},a):a,d=e===u.DASHBOARD_WIDGETS?i.createElement("div",{className:"notur-surface notur-surface--card notur-surface--widget"},c):c;return i.createElement(l,{key:`${r.extensionId}-${o}`,extensionId:r.extensionId},d)});return a.createPortal(c,o)}}function E({slotId:e,registry:t,componentProps:r={}}){const[o,n]=i.useState(t.getSlot(e));if(i.useEffect(()=>t.on("slot:"+e,()=>{n(t.getSlot(e))}),[e,t]),0===o.length)return null;const s=f(),a=o.filter(e=>h(e,s));return 0===a.length?null:i.createElement(i.Fragment,null,...a.map((t,o)=>{var n;const s=t.component,a=i.createElement(s,{extensionId:t.extensionId,...r,...null!==(n=t.props)&&void 0!==n?n:{}}),c=t.scopeClass?i.createElement("div",{className:t.scopeClass,"data-notur-extension":t.extensionId},a):a,d=e===u.DASHBOARD_WIDGETS?i.createElement("div",{className:"notur-surface notur-surface--card notur-surface--widget"},c):c;return i.createElement(l,{key:`${t.extensionId}-${o}`,extensionId:t.extensionId},d)}))}class b extends i.Component{constructor(e){super(e),this.handlePopState=()=>{this.setState({currentPath:window.location.pathname})},this.state={routes:e.registry.getRoutes(e.area),currentPath:window.location.pathname}}componentDidMount(){const{registry:e,area:t}=this.props;this.unsubscribeRoute=e.on("route:"+t,()=>{this.setState({routes:e.getRoutes(t)})}),this.unsubscribeExt=e.on("extension:registered",()=>{this.setState({routes:e.getRoutes(t)})}),window.addEventListener("popstate",this.handlePopState)}componentWillUnmount(){var e,t;null===(e=this.unsubscribeRoute)||void 0===e||e.call(this),null===(t=this.unsubscribeExt)||void 0===t||t.call(this),window.removeEventListener("popstate",this.handlePopState)}buildRoutePath(e){const t=this.props.basePath||"",r=e.path.startsWith("/")?e.path:"/"+e.path;return`${t}/notur/${e.extensionId}${r}`}matchRoute(e){const t=this.buildRoutePath(e),{currentPath:r}=this.state;return r===t||r.startsWith(t+"/")}render(){const{routes:e,currentPath:t}=this.state;for(const r of e)if(this.matchRoute(r)){const e=r.component,o=i.createElement(e,{extensionId:r.extensionId,currentPath:t}),n=r.scopeClass?i.createElement("div",{className:r.scopeClass,"data-notur-extension":r.extensionId},o):o;return i.createElement("div",{className:"notur-surface notur-surface--page notur-surface--route"},n)}return null}}function v(e){const[t,r]=i.useState([]);return i.useEffect(()=>{const t=window.__NOTUR__;if(!(null==t?void 0:t.registry))return;r(t.registry.getRoutes(e));const o=t.registry.on("route:"+e,()=>{r(t.registry.getRoutes(e))}),n=t.registry.on("extension:registered",()=>{r(t.registry.getRoutes(e))});return()=>{o(),n()}},[e]),t}function m(){var e,t;return null!==(t=null===(e=window.__NOTUR__)||void 0===e?void 0:e.registry)&&void 0!==t?t:null}function R(e){const[t,r]=(0,i.useState)(()=>{const t=m();return t?t.getSlot(e):[]}),o=(0,i.useRef)(e);return o.current=e,(0,i.useEffect)(()=>{const t=m();if(t){r(t.getSlot(e));const n=t.on("slot:"+e,()=>{r(t.getSlot(e))}),s=t.on("extension:registered",()=>{r(t.getSlot(o.current))});return()=>{n(),s()}}const n=setInterval(()=>{const e=m();e&&(r(e.getSlot(o.current)),clearInterval(n))},50);return()=>clearInterval(n)},[e]),t}function S({extensionId:e,baseUrl:t}){const[r,o]=(0,i.useState)({data:null,loading:!1,error:null}),n=(0,i.useRef)(!0),s=(0,i.useRef)(new Set);(0,i.useEffect)(()=>(n.current=!0,()=>{n.current=!1,s.current.forEach(e=>e.abort()),s.current.clear()}),[]);const a=t||`/api/client/notur/${e}`,c=(0,i.useCallback)(async(e,t={})=>{n.current&&o(e=>({...e,loading:!0,error:null}));const r=new AbortController;s.current.add(r);try{const s=`${a}${e.startsWith("/")?e:"/"+e}`,i={"Content-Type":"application/json",Accept:"application/json",...t.headers||{}},c=(t.method||"GET").toUpperCase();if("GET"!==c&&"HEAD"!==c&&"OPTIONS"!==c){const e=function(){const e=document.querySelector('meta[name="csrf-token"]');if(e){const t=e.getAttribute("content");if(t)return t}const t=document.cookie.split("; ").find(e=>e.startsWith("XSRF-TOKEN="));return t?decodeURIComponent(t.split("=")[1]):null}();e&&(i["X-CSRF-TOKEN"]=e,i["X-XSRF-TOKEN"]=e)}const u=await fetch(s,{...t,headers:i,credentials:"same-origin",signal:r.signal});if(!u.ok){let e=`API error: ${u.status} ${u.statusText}`;try{const t=await u.json();if(t.message)e=t.message;else if(t.errors){const r=[];for(const e in t.errors){if(!Object.prototype.hasOwnProperty.call(t.errors,e))continue;const o=t.errors[e];if(Array.isArray(o))for(const e of o)r.push(String(e));else null!=o&&r.push(String(o))}r.length>0&&(e=r.join(", "))}}catch{}throw new Error(e)}if(204===u.status)return n.current&&o({data:null,loading:!1,error:null}),null;const d=await u.json();return n.current&&o({data:d,loading:!1,error:null}),d}catch(e){if("AbortError"===e.name)return null;const t=e.message||"Unknown error";throw n.current&&o(e=>({...e,loading:!1,error:t})),e}finally{s.current.delete(r)}},[a]);return{...r,get:(0,i.useCallback)(e=>c(e,{method:"GET"}),[c]),post:(0,i.useCallback)((e,t)=>c(e,{method:"POST",body:null!=t?JSON.stringify(t):void 0}),[c]),put:(0,i.useCallback)((e,t)=>c(e,{method:"PUT",body:null!=t?JSON.stringify(t):void 0}),[c]),patch:(0,i.useCallback)((e,t)=>c(e,{method:"PATCH",body:null!=t?JSON.stringify(t):void 0}),[c]),delete:(0,i.useCallback)(e=>c(e,{method:"DELETE"}),[c]),request:c}}class y{constructor(e){this.listeners=new Set,this.state={...e}}getState(){return this.state}setState(e){this.state={...this.state,...e},this.listeners.forEach(e=>{try{e(this.state)}catch(e){console.error("[Notur] Error in state listener:",e)}})}resetState(e){this.state=e?{...e}:{},this.listeners.forEach(e=>{try{e(this.state)}catch(e){console.error("[Notur] Error in state listener:",e)}})}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}get listenerCount(){return this.listeners.size}}const _=new Map;function O(e,t){const r=function(e,t){return _.has(e)||_.set(e,new y(t)),_.get(e)}(e,t),[o,n]=(0,i.useState)(r.getState()),s=(0,i.useRef)(e);return s.current=e,(0,i.useEffect)(()=>{n(r.getState());const e=r.subscribe(n);return()=>{e(),0===r.listenerCount&&_.delete(s.current)}},[r]),[o,(0,i.useCallback)(e=>r.setState(e),[r]),(0,i.useCallback)(()=>r.resetState(t),[r,t])]}const A={"--notur-primary":"#0967d2","--notur-primary-light":"#47a3f3","--notur-primary-dark":"#03449e","--notur-secondary":"#7c8b9a","--notur-success":"#27ab83","--notur-danger":"#e12d39","--notur-warning":"#f7c948","--notur-info":"#2bb0ed","--notur-bg-primary":"#0b0d10","--notur-bg-secondary":"rgba(17, 19, 24, 0.68)","--notur-bg-tertiary":"rgba(25, 28, 35, 0.8)","--notur-text-primary":"#f1f5f9","--notur-text-secondary":"#cbd5e1","--notur-text-muted":"#94a3b8","--notur-border":"rgba(148, 163, 184, 0.18)","--notur-glass-bg":"rgba(17, 19, 24, 0.55)","--notur-glass-border":"rgba(255, 255, 255, 0.12)","--notur-glass-highlight":"rgba(255, 255, 255, 0.06)","--notur-glass-shadow":"0 16px 40px rgba(0, 0, 0, 0.55)","--notur-glass-blur":"16px","--notur-radius-sm":"6px","--notur-radius-md":"12px","--notur-radius-lg":"18px","--notur-font-sans":'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',"--notur-font-mono":'"Fira Code", "JetBrains Mono", monospace'},T={"--ptero-primary":"--notur-primary","--ptero-primary-light":"--notur-primary-light","--ptero-primary-dark":"--notur-primary-dark","--ptero-success":"--notur-success","--ptero-danger":"--notur-danger","--ptero-warning":"--notur-warning","--ptero-info":"--notur-info"},w=[{selector:"#app",cssProp:"background-color",noturVar:"--notur-bg-primary"},{selector:"#app",cssProp:"color",noturVar:"--notur-text-primary"},{selector:'a.text-neutral-200, a[class*="NavigationBar"]',cssProp:"color",noturVar:"--notur-text-secondary"},{selector:"input",cssProp:"background-color",noturVar:"--notur-bg-secondary"},{selector:"input",cssProp:"border-color",noturVar:"--notur-border"},{selector:'button.bg-primary-500, button[class*="primary"]',cssProp:"background-color",noturVar:"--notur-primary"}];function x(){const e={},t=getComputedStyle(document.documentElement);for(const[r,o]of Object.entries(T)){const n=t.getPropertyValue(r).trim();n&&(e[o]=n)}for(const t of w){if(e[t.noturVar])continue;const r=document.querySelector(t.selector);if(r){const o=getComputedStyle(r).getPropertyValue(t.cssProp).trim();o&&"rgba(0, 0, 0, 0)"!==o&&"transparent"!==o&&(e[t.noturVar]=o)}}try{for(const t of Array.from(document.styleSheets))try{for(const r of Array.from(t.cssRules||[]))if(r instanceof CSSStyleRule&&":root"===r.selectorText)for(let t=0;t<r.style.length;t++){const o=r.style[t];if(o.startsWith("--ptero-")&&T[o]){const t=T[o];e[t]||(e[t]=r.style.getPropertyValue(o).trim())}}}catch{}}catch{}return e}function N(e){const t=document.documentElement;for(const[r,o]of Object.entries(e))t.style.setProperty(r,o)}const I=i.createContext({variables:A,extensionOverrides:{}});function C({overrides:e,registry:t,children:r}){const[o,n]=i.useState({});i.useEffect(()=>{const e=requestAnimationFrame(()=>{n(x())});return()=>cancelAnimationFrame(e)},[]);const[s,a]=i.useState(t?t.getThemeOverrides():{});i.useEffect(()=>{if(t)return a(t.getThemeOverrides()),t.on("theme:changed",()=>{a(t.getThemeOverrides())})},[t]);const c=i.useMemo(()=>({...A,...o,...s,...e}),[o,s,e]);i.useEffect(()=>{N(c)},[c]);const u=i.useMemo(()=>({variables:c,extensionOverrides:s}),[c,s]);return i.createElement(I.Provider,{value:u},r)}function D(){return i.useContext(I)}const F="notur-glass-styles";if("undefined"!=typeof window){const e=window;e.React?e.React!==i&&console.warn("[Notur] Detected multiple React instances on window. This can break hooks."):e.React=i,e.ReactDOM?e.ReactDOM!==a&&console.warn("[Notur] Detected multiple ReactDOM instances on window. This can break hooks."):e.ReactDOM=a}const B=new Map;function V(e,t){if(B.has(e))return;const r=`notur-slot-${e}`,o=r=>{if(B.has(e))return;const o=document.createElement("div");o.setAttribute("data-notur-renderer",e),r.appendChild(o);const n=i.createElement(g,{slotId:e,registry:t});a.render(n,o),B.set(e,{unmount:()=>{a.unmountComponentAtNode(o),o.remove()}}),console.log(`[Notur] Slot renderer mounted: ${e}`)},n=document.getElementById(r);if(n)return void o(n);const s=new MutationObserver((e,t)=>{const n=document.getElementById(r);n&&(t.disconnect(),o(n))});s.observe(document.body,{childList:!0,subtree:!0}),setTimeout(()=>s.disconnect(),3e4)}let k=null;function P(){const e=window.__NOTUR__||{},t=new c;N(A),function(){if("undefined"==typeof document)return;if(document.getElementById(F))return;const e=document.createElement("style");e.id=F,e.textContent="\n:root {\n  --notur-surface-padding: 16px;\n  --notur-surface-gap: 12px;\n}\n\n.notur-surface {\n  background: linear-gradient(135deg, var(--notur-glass-highlight), rgba(255, 255, 255, 0) 65%), var(--notur-glass-bg);\n  border: 1px solid var(--notur-glass-border);\n  border-radius: var(--notur-radius-lg);\n  box-shadow: var(--notur-glass-shadow);\n  backdrop-filter: blur(var(--notur-glass-blur));\n  -webkit-backdrop-filter: blur(var(--notur-glass-blur));\n  color: var(--notur-text-primary);\n}\n\n.notur-surface--card {\n  padding: var(--notur-surface-padding);\n}\n\n.notur-surface--page {\n  padding: clamp(16px, 2.4vw, 28px);\n}\n\n#notur-slot-dashboard\\.widgets > .notur-surface {\n  margin-bottom: var(--notur-surface-gap);\n}\n\n#notur-slot-dashboard\\.widgets > .notur-surface:last-child {\n  margin-bottom: 0;\n}\n",document.head.appendChild(e)}();try{const e=x();Object.keys(e).length>0&&(N(e),console.log(`[Notur] Extracted ${Object.keys(e).length} theme variables from panel`))}catch(e){console.warn("[Notur] Failed to extract panel theme variables:",e)}const r=function(e){const t=()=>{console.group("[Notur] Debug Summary"),t.extensions(),t.slots(),t.routes(),t.theme(),console.groupEnd()};return t.extensions=()=>{const t=e.getExtensions();console.group(`[Notur] Extensions (${t.length})`);for(const e of t)console.log(`  ${e.id} v${e.version} — ${e.slots.length} slots, ${e.routes.length} routes`);0===t.length&&console.log("  (none)"),console.groupEnd()},t.slots=()=>{var t,r;const o=window.__NOTUR__,n=null==o?void 0:o.SLOT_IDS;if(console.group("[Notur] Slots"),n)for(const o of Object.keys(n)){const s=n[o],i=e.getSlot(s);if(i.length>0){console.group(`  ${s} (${i.length} components)`);for(const e of i){const o=null!==(t=e.priority)&&void 0!==t?t:0,n=null!==(r=e.order)&&void 0!==r?r:0;console.log(`    [p${o} o${n}] ${e.extensionId} — ${e.component.displayName||e.component.name||"Anonymous"}`)}console.groupEnd()}}console.groupEnd()},t.routes=()=>{const t=["server","dashboard","account"];console.group("[Notur] Routes");for(const r of t){const t=e.getRoutes(r);if(t.length>0){console.group(`  ${r} (${t.length})`);for(const e of t)console.log(`    ${e.path} — ${e.name} (${e.extensionId})`);console.groupEnd()}}console.groupEnd()},t.theme=()=>{const t=e.getThemeOverrides(),r=Object.keys(t);console.group(`[Notur] Theme Overrides (${r.length})`);for(const e of r)console.log(`  ${e}: ${t[e]}`);0===r.length&&console.log("  (none)"),console.groupEnd()},t.events=()=>{const t=["change","extension:registered","extension:unregistered","theme:changed"],r=[];for(const o of t)r.push(e.on(o,()=>{console.log(`[Notur Event] ${o}`,(new Date).toISOString())}));return console.log("[Notur] Event logging enabled. Call the returned function to stop."),()=>{r.forEach(e=>e()),console.log("[Notur] Event logging disabled.")}},t}(t);if(window.__NOTUR__={...e,version:e.version||"dev",registry:t,routes:[],unregisterExtension:e=>t.unregisterExtension(e),emitEvent:(e,r)=>t.emitEvent(e,r),onEvent:(e,r)=>t.onEvent(e,r),SlotRenderer:g,InlineSlot:E,RouteRenderer:b,hooks:{useSlot:R,useExtensionApi:S,useExtensionState:O,useNoturTheme:D,useRoutes:v},ThemeProvider:C,SLOT_IDS:u,SLOT_DEFINITIONS:d,debug:r,diagnostics:e.diagnostics||{errors:[]}},console.log(`[Notur] Bridge runtime v${window.__NOTUR__.version} initialized`),e.slots)for(const[t,r]of Object.entries(e.slots))for(const[e]of Object.entries(r))console.log(`[Notur] Slot defined: ${e} by ${t}`);!function(e){if(k)return;const t=document.createElement("div");t.id="notur-theme-root",t.style.display="none",document.body.appendChild(t);const r=i.createElement(C,{registry:e,children:null});a.render(r,t),k=()=>{a.unmountComponentAtNode(t),t.remove()},console.log("[Notur] ThemeProvider root mounted")}(t),function(e){for(const t of d)V(t.id,e)}(t)}return"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",P):P()),s})());